{"id":"code-1","title":"Phase 0: Set up crate structure and library root","description":"Create the module structure as defined in ARCHITECTURE.md:\n- src/lib.rs with crate-level #![forbid(unsafe_code)]\n- Module declarations for cli, config, rules, engine, output\n- Empty mod.rs files for each module (per STYLE_GUIDE: use non-mod-rs layout)\n- Add base dependencies to Cargo.toml (thiserror, serde)\n\nDefinition of Done:\n- cargo check passes\n- cargo fmt --check passes  \n- cargo clippy passes\n- Module structure matches ARCHITECTURE.md","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-12T03:58:52.233576883Z","created_by":"Danver Braganza","updated_at":"2026-01-12T04:10:02.840672554Z","labels":["phase-0-foundation"]}
{"id":"code-10","title":"Phase 3: Define Rule trait and Violation struct","description":"Create src/rules/rule.rs:\n- Rule trait with methods: id(), description(), languages(), severity(), execute()\n- ExecutionContext struct (file_path, content, optional AST reference)\n- Violation struct with: rule_id, file, line, column, end_line, end_column, snippet, message, region\n\nThe Rule trait must be Send + Sync for parallel execution.\n\nDepends on: code-9\n\nDefinition of Done:\n- Rule trait is defined and documented\n- Violation struct captures all fields needed for output\n- Types are properly bounded for thread safety\n- cargo check/fmt/clippy pass","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T04:00:12.564936045Z","created_by":"Danver Braganza","updated_at":"2026-01-12T08:47:22.357700548Z","labels":["phase-3-rules"],"dependencies":[{"issue_id":"code-10","depends_on_id":"code-9","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-11","title":"Phase 3: Implement RegexRule","description":"Create src/rules/regex_rule.rs:\n- RegexRule struct implementing Rule trait\n- Parse regex patterns from rule definition TOML\n- Execute regex against file content using regex crate\n- Convert match positions to line/column using precomputed line offsets\n- Extract snippet around match\n\nUse regex crate. Consider RegexSet for multi-pattern matching if needed.\n\nDepends on: code-10\n\nDefinition of Done:\n- RegexRule can be constructed from TOML definition\n- Matches are found with correct positions\n- Snippets are extracted properly\n- cargo check/fmt/clippy pass","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T04:00:18.563777714Z","created_by":"Danver Braganza","updated_at":"2026-01-12T08:54:02.18839222Z","labels":["phase-3-rules"],"dependencies":[{"issue_id":"code-11","depends_on_id":"code-10","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-12","title":"Phase 3: Implement RuleRegistry","description":"Create src/rules/registry.rs:\n- RuleRegistry struct to hold all enabled rules\n- Load rules from: built-in definitions, custom ratchets/regex/, custom ratchets/ast/\n- Parse rule definition TOML format from builtin-ratchets/\n- Filter rules by enabled status in config\n- Provide get_rule(id) and iter_rules() methods\n\nDepends on: code-11\n\nDefinition of Done:\n- Can load built-in regex rules from builtin-ratchets/regex/\n- Can load custom rules from ratchets/ directory\n- Filters based on config.rules settings\n- cargo check/fmt/clippy pass","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T04:00:25.013315176Z","created_by":"Danver Braganza","updated_at":"2026-01-12T08:59:52.45261884Z","labels":["phase-3-rules"],"dependencies":[{"issue_id":"code-12","depends_on_id":"code-11","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-13","title":"Phase 3: Test regex rules","description":"Create tests for regex rule execution:\n- Unit tests for regex pattern matching\n- Tests for line/column position calculation\n- Tests for multi-line patterns\n- Tests for case-insensitive matching\n- Tests for snippet extraction\n- Integration tests with no-todo-comments and no-fixme-comments rules\n\nDepends on: code-12\n\nDefinition of Done:\n- Regex rules find correct matches in test files\n- Positions are accurate\n- cargo nextest run passes","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T04:00:30.129079261Z","created_by":"Danver Braganza","updated_at":"2026-01-12T09:06:04.551622721Z","labels":["phase-3-rules","testing"],"dependencies":[{"issue_id":"code-13","depends_on_id":"code-12","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-14","title":"Phase 4: Add tree-sitter dependencies and parser loading","description":"Create src/rules/ast/parser_cache.rs:\n- Add tree-sitter and language grammar crates to Cargo.toml as optional features\n- ParserCache struct for lazy grammar loading\n- get_parser(Language) -\u003e Result\u003c\u0026Parser\u003e\n- Cache parsed parsers to avoid reloading\n\nLanguages to support (v1): Rust, TypeScript, JavaScript, Python, Go\nUse feature flags to make grammars optional.\n\nDepends on: code-13\n\nDefinition of Done:\n- tree-sitter crate compiles\n- Can load parser for each supported language\n- Parsers are cached after first load\n- cargo check/fmt/clippy pass","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T04:00:43.859620462Z","created_by":"Danver Braganza","updated_at":"2026-01-12T09:12:10.893098918Z","labels":["phase-4-ast"],"dependencies":[{"issue_id":"code-14","depends_on_id":"code-13","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-15","title":"Phase 4: Implement AstRule for tree-sitter queries","description":"Create src/rules/ast_rule.rs:\n- AstRule struct implementing Rule trait\n- Parse tree-sitter query syntax from rule definition TOML\n- Execute query against parsed AST\n- Extract match positions from query captures\n- Handle @violation capture for reporting location\n\nQuery format follows tree-sitter S-expression syntax as shown in DESIGN.md.\n\nDepends on: code-14\n\nDefinition of Done:\n- AstRule can be constructed from TOML definition\n- Queries execute against parsed trees\n- Match positions are correctly extracted\n- cargo check/fmt/clippy pass","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T04:00:49.379160131Z","created_by":"Danver Braganza","updated_at":"2026-01-12T09:24:35.817293971Z","labels":["phase-4-ast"],"dependencies":[{"issue_id":"code-15","depends_on_id":"code-14","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-16","title":"Phase 4: Integrate AST rules into RuleRegistry","description":"Update src/rules/registry.rs:\n- Load AST rules from builtin-ratchets/ast/{language}/\n- Load custom AST rules from ratchets/ast/\n- Differentiate regex vs AST rules during loading\n- Validate tree-sitter query syntax on load\n\nDepends on: code-15\n\nDefinition of Done:\n- Registry loads both regex and AST rules\n- Built-in AST rules (no-unwrap, no-expect, no-panic) are loadable\n- Invalid queries produce clear error messages\n- cargo check/fmt/clippy pass","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T04:00:55.040490009Z","created_by":"Danver Braganza","updated_at":"2026-01-12T09:31:36.925235805Z","labels":["phase-4-ast"],"dependencies":[{"issue_id":"code-16","depends_on_id":"code-15","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-17","title":"Phase 4: Test AST rules with tree-sitter","description":"Create tests for AST rule execution:\n- Unit tests for tree-sitter query execution\n- Tests for Rust no-unwrap, no-expect, no-panic rules\n- Tests for TypeScript no-any rule\n- Tests for Python no-bare-except rule\n- Tests verifying correct position extraction\n- Tests for query validation errors\n\nCreate test fixtures in tests/fixtures/ast_rules/\n\nDepends on: code-16\n\nDefinition of Done:\n- AST rules correctly find violations in test code\n- Positions match expected locations\n- All built-in AST rules have test coverage\n- cargo nextest run passes","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T04:01:00.720350262Z","created_by":"Danver Braganza","updated_at":"2026-01-12T09:40:04.719840887Z","labels":["phase-4-ast","testing"],"dependencies":[{"issue_id":"code-17","depends_on_id":"code-16","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-18","title":"Phase 5: Implement parallel execution engine with rayon","description":"Create src/engine/executor.rs:\n- ExecutionEngine struct coordinating all components\n- Parallel file processing using rayon\n- Parallel rule execution across files\n- AST caching: parse once, share across rules\n- Collect violations from all rules\n\nExecution flow from ARCHITECTURE.md:\n1. Discover files\n2. Parse ASTs in parallel (for AST rules)\n3. Execute rules in parallel\n4. Collect violations\n\nDepends on: code-17\n\nDefinition of Done:\n- Engine executes all enabled rules\n- Uses rayon for parallelism\n- ASTs are parsed once and reused\n- cargo check/fmt/clippy pass","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:01:13.045210628Z","created_by":"Danver Braganza","updated_at":"2026-01-12T09:45:08.018498222Z","labels":["phase-5-engine"],"dependencies":[{"issue_id":"code-18","depends_on_id":"code-17","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-19","title":"Phase 5: Implement violation aggregation by region","description":"Create src/engine/aggregator.rs:\n- ViolationAggregator struct\n- Group violations by (rule_id, region_path)\n- Compute violation counts per rule/region\n- Compare against budgets from CountsManager\n- Determine pass/fail status per rule/region\n\nRegion assignment: map file path to its containing region based on counts file.\n\nDepends on: code-18\n\nDefinition of Done:\n- Violations are correctly grouped by region\n- Count comparison with budgets works\n- Pass/fail status is correctly determined\n- cargo check/fmt/clippy pass","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:01:19.000453881Z","created_by":"Danver Braganza","updated_at":"2026-01-12T09:49:28.592225676Z","labels":["phase-5-engine"],"dependencies":[{"issue_id":"code-19","depends_on_id":"code-18","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-2","title":"Phase 0: Define core error types with thiserror","description":"Create src/error.rs with RatchetError enum:\n- ConfigError variant for configuration issues\n- RuleError variant for rule parsing/validation errors\n- ParseError variant for source file parse errors (includes file path)\n- IoError variant (wrap std::io::Error)\n\nFollow the error types from ARCHITECTURE.md. Use thiserror for derive macros.\n\nDepends on: code-1 (crate structure)\n\nDefinition of Done:\n- RatchetError enum is defined with all variants\n- Implements std::error::Error via thiserror\n- cargo check passes\n- cargo clippy passes","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-12T03:59:02.899449346Z","created_by":"Danver Braganza","updated_at":"2026-01-12T04:12:26.373171426Z","labels":["phase-0-foundation"],"dependencies":[{"issue_id":"code-2","depends_on_id":"code-1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-20","title":"Phase 5: Test execution engine","description":"Create tests for execution engine:\n- Unit tests for parallel execution\n- Tests for AST caching behavior\n- Tests for violation aggregation\n- Tests for region assignment\n- Tests for budget comparison\n- Integration test with multiple rules and files\n\nDepends on: code-19\n\nDefinition of Done:\n- Engine correctly executes rules in parallel\n- Aggregation groups violations properly\n- Budget comparisons are accurate\n- cargo nextest run passes within 120s timeout","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:01:24.333062759Z","created_by":"Danver Braganza","updated_at":"2026-01-12T09:56:57.556807925Z","labels":["phase-5-engine","testing"],"dependencies":[{"issue_id":"code-20","depends_on_id":"code-19","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-21","title":"Phase 6: Implement CLI argument parsing with clap","description":"Create src/cli/args.rs:\n- Use clap derive macros for argument parsing\n- Define subcommands: check, init, bump, tighten, list, merge-driver\n- Common options: --format (human|jsonl), --color (auto|always|never)\n- check: optional paths, --format\n- init: --force flag\n- bump: rule-id, --region, --count\n- tighten: optional rule-id, --region\n- list: --format\n- merge-driver: positional args for %O %A %B\n\nDepends on: code-20\n\nDefinition of Done:\n- All subcommands parse correctly\n- Help text is clear and complete\n- cargo check/fmt/clippy pass","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:01:37.416199459Z","created_by":"Danver Braganza","updated_at":"2026-01-12T10:01:51.722252881Z","labels":["phase-6-cli"],"dependencies":[{"issue_id":"code-21","depends_on_id":"code-20","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-22","title":"Phase 6: Implement 'ratchet init' command","description":"Create src/cli/init.rs:\n- Create ratchet.toml with sensible defaults\n- Create empty ratchet-counts.toml\n- Create ratchets/regex/ and ratchets/ast/ directories\n- Skip existing files unless --force\n- Idempotent: safe to run multiple times\n\nDepends on: code-21\n\nDefinition of Done:\n- Init creates all required files\n- --force overwrites existing files\n- Without --force, existing files are preserved\n- Exit code 0 on success, 2 on error\n- cargo check/fmt/clippy pass","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:01:43.117859295Z","created_by":"Danver Braganza","updated_at":"2026-01-12T10:08:32.879530094Z","labels":["phase-6-cli"],"dependencies":[{"issue_id":"code-22","depends_on_id":"code-21","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-23","title":"Phase 6: Implement 'ratchet check' command","description":"Create src/cli/check.rs:\n- Load config and counts\n- Build rule registry\n- Run execution engine\n- Format output (human or JSONL)\n- Return appropriate exit code (0=pass, 1=exceeded, 2=error, 3=parse error)\n\nThis is the primary command that ties everything together.\n\nDepends on: code-22\n\nDefinition of Done:\n- Check runs all enabled rules\n- Output format respects --format flag\n- Exit codes match DESIGN.md specification\n- cargo check/fmt/clippy pass","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:01:50.197103298Z","created_by":"Danver Braganza","updated_at":"2026-01-12T10:15:06.243986388Z","labels":["phase-6-cli"],"dependencies":[{"issue_id":"code-23","depends_on_id":"code-22","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-24","title":"Phase 6: Implement 'ratchet bump' command","description":"Create src/cli/bump.rs:\n- Parse rule-id, --region, --count arguments\n- If --count provided: set budget to that value\n- If --count omitted: run check for that rule/region, use current count\n- Update ratchet-counts.toml\n- Fail if new count is lower than current violations (suggest tighten)\n\nDepends on: code-23\n\nDefinition of Done:\n- Bump updates counts file correctly\n- Auto-detect works when --count omitted\n- Error if trying to bump below current violations\n- cargo check/fmt/clippy pass","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:01:56.496729676Z","created_by":"Danver Braganza","updated_at":"2026-01-12T10:21:09.841644208Z","labels":["phase-6-cli"],"dependencies":[{"issue_id":"code-24","depends_on_id":"code-23","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-25","title":"Phase 6: Implement 'ratchet tighten' command","description":"Create src/cli/tighten.rs:\n- Run check to get current violation counts\n- For each rule/region: if current \u003c budget, reduce budget to current\n- Fail if any current \u003e budget (violations exceed budget)\n- Update ratchet-counts.toml\n- Support filtering by rule-id and --region\n\nDepends on: code-24\n\nDefinition of Done:\n- Tighten reduces budgets to current counts\n- Fails if violations exceed budget\n- Optional filtering by rule/region works\n- cargo check/fmt/clippy pass","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:02:02.783316596Z","created_by":"Danver Braganza","updated_at":"2026-01-12T10:29:52.622635089Z","labels":["phase-6-cli"],"dependencies":[{"issue_id":"code-25","depends_on_id":"code-24","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-26","title":"Phase 6: Implement 'ratchet list' command","description":"Create src/cli/list.rs:\n- List all enabled rules with their status\n- Show: rule ID, source (built-in/custom), languages, current count, budget, status\n- Support --format human|jsonl\n\nDepends on: code-25\n\nDefinition of Done:\n- Lists all enabled rules\n- Shows accurate current counts and budgets\n- Both output formats work\n- cargo check/fmt/clippy pass","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:02:07.992282876Z","created_by":"Danver Braganza","updated_at":"2026-01-12T10:53:18.854456922Z","labels":["phase-6-cli"],"dependencies":[{"issue_id":"code-26","depends_on_id":"code-25","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-27","title":"Phase 6: Implement 'ratchet merge-driver' command","description":"Create src/cli/merge_driver.rs:\n- Accept three positional arguments: base (%O), ours (%A), theirs (%B)\n- Parse all three TOML files\n- Build unified set of all rule/region keys\n- For each key: result = min(ours, theirs)\n- Write merged result to ours file (%A)\n- Exit 0 on success, non-zero on parse failure\n\nThis enables conflict-free merges of ratchet-counts.toml.\n\nDepends on: code-26\n\nDefinition of Done:\n- Merge driver correctly takes minimum counts\n- Handles missing keys (use default/inherit)\n- Writes valid TOML output\n- cargo check/fmt/clippy pass","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:02:14.964938087Z","created_by":"Danver Braganza","updated_at":"2026-01-12T11:17:32.708214839Z","labels":["phase-6-cli"],"dependencies":[{"issue_id":"code-27","depends_on_id":"code-26","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-28","title":"Phase 6: Test CLI commands","description":"Create tests for all CLI commands:\n- Integration tests for init (creates files, --force behavior)\n- Integration tests for check (exit codes, output)\n- Integration tests for bump (updates counts, auto-detect)\n- Integration tests for tighten (reduces counts, fails on exceeded)\n- Integration tests for list (output formats)\n- Integration tests for merge-driver (minimum wins)\n\nUse assert_cmd or similar for CLI testing.\n\nDepends on: code-27\n\nDefinition of Done:\n- All commands have test coverage\n- Exit codes are verified\n- Output formats are verified\n- cargo nextest run passes","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:02:20.990333674Z","created_by":"Danver Braganza","updated_at":"2026-01-12T11:22:50.52023775Z","labels":["phase-6-cli","testing"],"dependencies":[{"issue_id":"code-28","depends_on_id":"code-27","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-29","title":"Phase 7: Implement human-readable output formatter","description":"Create src/output/human.rs:\n- HumanFormatter struct\n- Colorized output using termcolor (when TTY or --color=always)\n- Group violations by rule, then by region\n- Show violation locations with snippets\n- Use symbols: ✓ for pass, ✗ for fail\n- Summary line at end\n\nOutput format should match example in DESIGN.md.\n\nDepends on: code-28\n\nDefinition of Done:\n- Output matches DESIGN.md format\n- Colors work on supported terminals\n- --color flag is respected\n- cargo check/fmt/clippy pass","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:02:32.211114012Z","created_by":"Danver Braganza","updated_at":"2026-01-12T11:29:23.981809752Z","labels":["phase-7-output"],"dependencies":[{"issue_id":"code-29","depends_on_id":"code-28","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-3","title":"Phase 0: Define Language enum and core domain types","description":"Create src/types.rs with:\n- Language enum (Rust, TypeScript, JavaScript, Python, Go)\n- RuleId newtype (wrapping String with validation)\n- RegionPath newtype (normalized path handling)\n- Severity enum (Error, Warning, Info)\n- GlobPattern wrapper type\n\nThese are the foundational domain types used throughout the codebase.\n\nDepends on: code-2\n\nDefinition of Done:\n- All types are defined with appropriate derives (Debug, Clone, PartialEq, Eq, Hash as needed)\n- Types are re-exported from lib.rs\n- cargo check passes\n- cargo clippy passes","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-12T03:59:09.36557946Z","created_by":"Danver Braganza","updated_at":"2026-01-12T04:18:41.268953211Z","labels":["phase-0-foundation"],"dependencies":[{"issue_id":"code-3","depends_on_id":"code-2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-30","title":"Phase 7: Implement JSONL output formatter","description":"Create src/output/jsonl.rs:\n- JsonlFormatter struct\n- Three record types: violation, summary, status\n- One JSON object per line\n- Deterministic ordering (sorted by rule, file, line)\n- Include all fields from DESIGN.md schema\n\nRecord schemas from DESIGN.md:\n- violation: type, rule, file, line, column, end_line, end_column, snippet, message, region\n- summary: type, rule, region, violations, budget, status  \n- status: type, passed, rules_checked, rules_exceeded, total_violations\n\nDepends on: code-29\n\nDefinition of Done:\n- All record types are output correctly\n- JSON is valid and parseable\n- Output is deterministically sorted\n- cargo check/fmt/clippy pass","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:02:38.559741043Z","created_by":"Danver Braganza","updated_at":"2026-01-12T11:34:56.326530628Z","labels":["phase-7-output"],"dependencies":[{"issue_id":"code-30","depends_on_id":"code-29","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-31","title":"Phase 7: Test output formatters","description":"Create tests for output formatters:\n- Unit tests for human formatter output\n- Unit tests for JSONL formatter output\n- Tests for color handling (auto/always/never)\n- Tests for deterministic ordering in JSONL\n- Tests for special characters in file paths/snippets\n- Snapshot tests for expected output formats\n\nDepends on: code-30\n\nDefinition of Done:\n- Both formatters produce correct output\n- JSONL is valid JSON\n- Deterministic output is verified\n- cargo nextest run passes","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-12T04:02:43.88481417Z","created_by":"Danver Braganza","updated_at":"2026-01-12T11:39:01.511745547Z","labels":["phase-7-output","testing"],"dependencies":[{"issue_id":"code-31","depends_on_id":"code-30","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-32","title":"Phase 8: End-to-end integration tests","description":"Create comprehensive end-to-end tests in tests/:\n- Test full workflow: init -\u003e add violations -\u003e check -\u003e tighten\n- Test with real multi-file projects\n- Test with mixed regex and AST rules\n- Test region inheritance across directory structure\n- Test gitignore interaction\n- Test all exit codes in realistic scenarios\n\nCreate test fixture projects in tests/fixtures/projects/\n\nDepends on: code-31\n\nDefinition of Done:\n- E2E tests cover happy path and error cases\n- Tests complete within 120s timeout\n- Tests are deterministic\n- cargo nextest run passes","status":"done","priority":3,"issue_type":"task","created_at":"2026-01-12T04:02:56.809303301Z","created_by":"Danver Braganza","updated_at":"2026-01-12T11:49:52.679966334Z","labels":["phase-8-integration","testing"],"dependencies":[{"issue_id":"code-32","depends_on_id":"code-31","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-33","title":"Phase 8: Load built-in rules from compiled resources","description":"Implement loading of built-in rules:\n- Embed builtin-ratchets/ into binary using include_str! or rust-embed\n- Load at runtime without external file dependencies\n- Maintain ability to override with custom rules in ratchets/\n- Ensure all built-in rules from builtin-ratchets/ are available\n\nDepends on: code-32\n\nDefinition of Done:\n- Built-in rules work without external files\n- Binary is self-contained\n- Custom rules can still override built-in\n- cargo check/fmt/clippy pass","status":"done","priority":3,"issue_type":"task","created_at":"2026-01-12T04:03:03.219652179Z","created_by":"Danver Braganza","updated_at":"2026-01-12T12:08:49.83349818Z","labels":["phase-8-integration"],"dependencies":[{"issue_id":"code-33","depends_on_id":"code-32","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-34","title":"Phase 8: Performance testing and optimization","description":"Create performance benchmarks and optimize:\n- Benchmark rule execution on large codebases\n- Profile with flamegraph to identify bottlenecks\n- Verify parallel execution is effective\n- Test with 1000+ files to ensure scalability\n- Document performance characteristics\n\nFocus areas:\n- File I/O parallelism\n- AST parsing caching effectiveness\n- Regex compilation caching\n\nDepends on: code-33\n\nDefinition of Done:\n- Benchmarks exist for key operations\n- Performance is acceptable for large codebases\n- No obvious bottlenecks remain\n- cargo nextest run completes within 120s","status":"done","priority":3,"issue_type":"task","created_at":"2026-01-12T04:03:12.261043294Z","created_by":"Danver Braganza","updated_at":"2026-01-12T12:18:09.26752505Z","labels":["phase-8-integration"],"dependencies":[{"issue_id":"code-34","depends_on_id":"code-33","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-35","title":"Phase 8: Final polish and documentation review","description":"Final review and polish tasks:\n- Verify all exit codes match DESIGN.md\n- Review error messages for clarity\n- Ensure all public APIs are documented\n- Verify README.md examples work\n- Run cargo doc and fix any warnings\n- Final cargo fmt/clippy/nextest pass\n\nDepends on: code-34\n\nDefinition of Done:\n- All documentation is accurate\n- Examples in README work\n- No clippy warnings\n- All tests pass\n- Ready for release","status":"done","priority":3,"issue_type":"task","created_at":"2026-01-12T04:03:17.80037313Z","created_by":"Danver Braganza","updated_at":"2026-01-12T12:24:12.917940344Z","labels":["phase-8-integration"],"dependencies":[{"issue_id":"code-35","depends_on_id":"code-34","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-36","title":"Fix .git directory being scanned by adding .git/ to default exclusions","description":"The file walker uses hidden(false) which causes .git directory to be scanned. Add .git/** to the default exclusion patterns in the file walker to prevent binary git objects from being processed.","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-12T20:50:58.501428042Z","created_by":"Danver Braganza","updated_at":"2026-01-12T21:50:06.010114763Z","labels":["fix-ratchet"]}
{"id":"code-37","title":"Tighten AST rules to exclude #[cfg(test)] modules in source files","description":"Two issues:\\n1. The builtin rule exclude patterns like 'benches/**' don't match paths like './benches/performance.rs' due to the leading './'\\n2. Test modules inside source files (#[cfg(test)]) are not excluded by the AST rules\\n\\nThe simplest fix is to update the builtin rules to use '**/benches/**' and '**/tests/**' patterns instead of 'benches/**' and 'tests/**'.","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-12T20:51:07.928868713Z","created_by":"Danver Braganza","updated_at":"2026-01-12T21:54:29.148365385Z","labels":["fix-ratchet"]}
{"id":"code-38","title":"Set appropriate violation budgets in ratchet-counts.toml","description":"After fixing spurious issues (code-36, code-37), set the remaining violation budgets to allow ratchet check to pass. Only bump for valid violations that exist in production code.","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-12T20:51:13.286160799Z","created_by":"Danver Braganza","updated_at":"2026-01-12T21:59:31.846301303Z","labels":["fix-ratchet"],"dependencies":[{"issue_id":"code-38","depends_on_id":"code-36","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"code-38","depends_on_id":"code-37","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-39","title":"Create justfile with standard commands including just install","description":"Create a justfile for the project with standard development commands including:\\n- just install: Install the ratchet binary\\n- just build: Build the project\\n- just test: Run tests\\n- just check: Run ratchet check\\n- just fmt: Format code\\n- just lint: Run clippy\\n- Other useful development commands as appropriate","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T22:39:25.564513215Z","created_by":"Danver Braganza","updated_at":"2026-01-12T22:50:46.391037461Z"}
{"id":"code-4","title":"Phase 0: Test foundation infrastructure","description":"Add tests for foundation types:\n- Unit tests for error type conversions and display\n- Unit tests for Language enum serialization/deserialization\n- Unit tests for RuleId validation\n- Unit tests for RegionPath normalization\n\nCreate tests/foundation_tests.rs for integration tests.\n\nDepends on: code-3\n\nDefinition of Done:\n- All unit tests pass\n- cargo nextest run passes\n- cargo fmt --check passes\n- cargo clippy passes","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-12T03:59:14.532705754Z","created_by":"Danver Braganza","updated_at":"2026-01-12T04:26:05.821969471Z","labels":["phase-0-foundation","testing"],"dependencies":[{"issue_id":"code-4","depends_on_id":"code-3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-40","title":"Add curl-based install script for easy installation","description":"Create an install script that allows users to install ratchet via 'curl \u003curl\u003e | bash'. This should:\\n\\n1. Create an install.sh script in the repo root that:\\n   - Detects the user's OS and architecture\\n   - Downloads the appropriate pre-built binary from GitHub releases (or builds from source if no binary available)\\n   - Installs to a sensible location (~/.cargo/bin or /usr/local/bin)\\n   - Handles errors gracefully\\n\\n2. Update README.md to document the curl installation method\\n\\nThe install URL will be: https://raw.githubusercontent.com/imbue-ai/ratchet/main/install.sh\\n\\nExample usage to document:\\n  curl -sSf https://raw.githubusercontent.com/imbue-ai/ratchet/main/install.sh | bash","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-15T01:32:13.821710917Z","created_by":"Danver Braganza","updated_at":"2026-01-15T01:35:42.545402097Z"}
{"id":"code-41","title":"Restructure builtin-ratchets directory: language-first organization","description":"## Goal\nRestructure the builtin-ratchets directory to use language-first organization in preparation for adding multiple language-specific ratchets.\n\n## Current Structure\n```\nbuiltin-ratchets/\n├── ast/\n│   ├── python/\n│   │   └── no-bare-except.toml\n│   ├── rust/\n│   │   └── no-unwrap.toml, no-panic.toml, no-expect.toml\n│   └── typescript/\n│       └── no-any.toml\n└── regex/\n    └── no-todo-comments.toml, no-fixme-comments.toml\n```\n\n## Target Structure\n```\nbuiltin-ratchets/\n├── python/\n│   ├── ast/\n│   │   └── no-bare-except.toml\n│   └── regex/\n│       └── (Python-specific regex rules go here)\n├── rust/\n│   ├── ast/\n│   │   └── no-unwrap.toml, no-panic.toml, no-expect.toml\n│   └── regex/\n├── typescript/\n│   ├── ast/\n│   │   └── no-any.toml\n│   └── regex/\n└── common/\n    └── regex/\n        └── no-todo-comments.toml, no-fixme-comments.toml\n```\n\n## Files to Update\n\n### Source files with include_str! paths:\n- src/rules/builtin.rs - Update all include_str! paths\n\n### Documentation references:\n- src/rules/registry.rs (line 71, 206)\n- src/rules/regex_rule.rs (line 18-19)\n- src/cli/init.rs (line 80, 216, 334)\n- ARCHITECTURE.md (module structure section)\n- DESIGN.md (if it references the directory structure)\n\n### CLI commands that reference builtin paths:\n- src/cli/check.rs (line 180, 192)\n- src/cli/bump.rs\n- src/cli/tighten.rs\n\n## Implementation Notes\n- Move files to new locations first\n- Update all include_str! paths in builtin.rs\n- Update documentation and comments throughout\n- Run tests to ensure nothing is broken\n- Keep diffs minimal - this is a tidy/refactor, not a feature change\n\n## Definition of Done\n- All builtin ratchet TOML files are in language-first structure\n- All include_str! paths compile correctly\n- All tests pass (cargo nextest run)\n- cargo clippy passes\n- Documentation accurately reflects new structure","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-21T20:25:17.446208263Z","created_by":"Danver Braganza","updated_at":"2026-01-21T22:02:29.243357792Z","labels":["tidy-first"]}
{"id":"code-42","title":"Port Python regex ratchets from test_ratchets.py","description":"## Goal\nPort the Python-specific regex-based ratchets from ratchets/test_ratchets.py to builtin Python ratchets.\n\n## Prerequisites\n- Bead code-41: Directory restructure to language-first organization\n- Bead code-44: Reusable exclusion patterns with @reference syntax\n\n## Source Reference\nThe ratchets are defined in: ratchets/test_ratchets.py\n\n## Ratchets to Port (Regex-based)\n\nEach ratchet should become a TOML file in builtin-ratchets/python/regex/ with:\n- [rule] section: id, description, severity\n- [match] section: pattern, languages = [\"python\"]\n\n### Security ratchets (severity = \"error\"):\n1. **no-exec-usage**: pattern = \\`\\\\bexec\\\\s*\\\\(\\` - \"exec() should not be used due to security and maintainability concerns\"\n2. **no-eval-usage**: pattern = \\`\\\\beval\\\\s*\\\\(\\` - \"eval() should not be used due to security and maintainability concerns\"\n\n### Exception handling ratchets:\n3. **no-bare-except**: pattern = \\`except\\\\s*:\\` - \"Bare 'except:' catches all exceptions. Specify exception types\" (moved from AST)\n4. **no-broad-exception**: pattern = \\`except\\\\s+Exception\\\\b\\` - \"Catching 'Exception' is too broad. Use specific exception types\"\n5. **no-base-exception**: pattern = \\`except\\\\s+BaseException\\\\b\\` - \"Catching 'BaseException' catches system exits. Use specific types\"\n\n### Import style ratchets:\n6. **no-inline-imports**: pattern = \\`(?m)^[ \\\\t]+import\\\\s+\\\\w+|^[ \\\\t]+from\\\\s+\\\\S+\\\\s+import\\\\b\\` - \"Imports should be at the top of the file\"\n7. **no-relative-imports**: pattern = \\`(?m)^from\\\\s+\\\\.\\` - \"Always use absolute imports, never relative\"\n8. **no-import-datetime**: pattern = \\`(?m)^import datetime$\\` - \"Import specific items instead\"\n\n### Banned libraries ratchets:\n9. **no-asyncio-import**: pattern = \\`\\\\bimport\\\\s+asyncio\\\\b|\\\\bfrom\\\\s+asyncio\\\\b\\` - \"asyncio is banned. Use synchronous code\"\n10. **no-pandas-import**: pattern = \\`\\\\bimport\\\\s+pandas\\\\b|\\\\bfrom\\\\s+pandas\\\\b\\` - \"pandas is banned. Use polars instead\"\n11. **no-dataclasses-import**: pattern = \\`\\\\bimport\\\\s+dataclasses\\\\b|\\\\bfrom\\\\s+dataclasses\\\\b\\` - \"Use pydantic models instead\"\n12. **no-yaml-usage**: pattern = \\`yaml\\` - \"NEVER use YAML. Use TOML for configuration\"\n\n### Code patterns ratchets:\n13. **no-while-true**: pattern = \\`\\\\bwhile\\\\s+True\\\\s*:\\` - \"Use explicit conditions instead\"\n14. **no-namedtuple-usage**: pattern = \\`\\\\bnamedtuple\\\\s*\\\\(\\` - \"Use pydantic models instead\"\n15. **no-global-keyword**: pattern = \\`\\\\bglobal\\\\s+\\\\w+\\` - \"Pass state explicitly through function parameters\"\n16. **no-time-sleep**: pattern = \\`\\\\btime\\\\.sleep\\\\s*\\\\(|\\\\bfrom\\\\s+time\\\\s+import\\\\s+sleep\\\\b\\` - \"Use polling instead\"\n17. **no-bare-print**: pattern = \\`(?m)^\\\\s*print\\\\s*\\\\(\\` - \"Use logger instead\"\n18. **no-click-echo**: pattern = \\`\\\\bclick\\\\.echo\\\\b|\\\\bfrom\\\\s+click\\\\s+import\\\\s+.*\\\\becho\\\\b\\` - \"Use logger.info() instead\"\n\n### Type annotation ratchets:\n19. **no-bare-generic-types**: pattern = \\`:\\\\s*(list|dict|tuple|set|List|Dict|Tuple|Set|Mapping|Sequence)\\\\s*($|[,\\\\)\\\\]])\\` - \"Specify type parameters\"\n20. **no-typing-builtin-imports**: pattern = \\`\\\\bfrom\\\\s+typing\\\\s+import\\\\s+.*\\\\b(Dict|List|Set|Tuple)\\\\b\\` - \"Use lowercase builtins\"\n21. **no-literal-multi-options**: pattern = \\`Literal\\\\[.*,.*\\\\]\\` - \"Create an UpperCaseStrEnum instead\"\n\n### Docstring ratchets:\n22. **no-init-docstrings**: pattern = \\`(?m)def __init__[^:]*:\\\\s+\"\"\"\\` - \"Class docstring should describe the class\"\n23. **no-args-in-docstrings**: pattern = \\`\"\"\"[\\\\s\\\\S]{0,500}Args:\\` - \"Use inline parameter comments\"\n24. **no-returns-in-docstrings**: pattern = \\`\"\"\"[\\\\s\\\\S]{0,500}Returns:\\` - \"Use inline return type comments\"\n25. **no-trailing-comments**: pattern = \\`[^\\\\s#].*[ \\\\t]#(?!\\\\s*ty:\\\\s*ignore\\\\[)\\` - \"Comments should be on own line\"\n\n### Naming ratchets:\n26. **no-num-prefix**: pattern = \\`\\\\bnum_\\\\w+|\\\\bnumOf|\\\\bnum[A-Z]\\` - \"Use 'count' or 'idx' instead\"\n\n### Exception raising ratchets:\n27. **no-builtin-exception-raises**: pattern = \\`raise\\\\s+(ValueError|KeyError|TypeError|AttributeError|IndexError|RuntimeError|OSError|IOError)\\\\(\\` - \"Create custom exception types\"\n\n### Logging ratchets:\n28. **no-fstring-logging**: pattern = \\`logger\\\\.(trace|debug|info|warning|error|exception)\\\\(f\\` - \"Use loguru-style placeholder syntax\"\n\n## Implementation Notes\n- Use Rust regex syntax (escape backslashes appropriately in TOML)\n- Use (?m) flag for multiline patterns where needed\n- Set severity = \"error\" for security ratchets, \"warning\" for style ratchets\n- All rules should have languages = [\"python\"]\n- Test each regex pattern compiles and matches expected patterns\n\n## Definition of Done\n- All 28 regex ratchets are created as TOML files\n- All rules load successfully via load_builtin_regex_rules()\n- All tests pass\n- cargo clippy passes","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-21T20:25:47.424704346Z","created_by":"Danver Braganza","updated_at":"2026-01-21T22:39:21.123835884Z","labels":["python-ratchets"],"dependencies":[{"issue_id":"code-42","depends_on_id":"code-41","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"code-42","depends_on_id":"code-44","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-43","title":"Port Python AST ratchets from test_ratchets.py","description":"## Goal\nPort the Python-specific AST-based ratchets from ratchets/test_ratchets.py to builtin Python ratchets using tree-sitter queries.\n\n## Prerequisites\n- Bead code-41: Directory restructure to language-first organization\n- Bead code-44: Reusable exclusion patterns with @reference syntax\n\n## Source Reference\nThe ratchets are defined in: ratchets/test_ratchets.py\nThese use custom Python functions that do AST analysis.\n\n## Design Decisions (Resolved)\n\n**Decision 1**: no-bare-except → **Convert to regex rule** (moved to code-42)\nThe regex `except\\s*:` is simpler and more precise than the AST approach.\n\n**Decision 2**: Post-filtering in Rust → **Approved**\nFor rules requiring negative matching (like no-init-in-non-exception-classes), implement post-filter logic in Rust after tree-sitter returns matches.\n\n**Decision 3**: Test file exclusion → **Use @reference syntax**\nRules will use `exclude = \"@python_tests\"` referencing patterns defined in ratchet.toml (implemented in code-44).\n\n## Ratchets to Port (AST-based)\n\nEach ratchet should become a TOML file in builtin-ratchets/python/ast/ with:\n- [rule] section: id, description, severity\n- [match] section: language = \"python\", query = \"...\"\n\n### 1. no-if-elif-without-else\nOriginal: find_if_elif_without_else()\nDescription: \"All if/elif chains must have an else clause to ensure all cases are handled explicitly\"\n\nTree-sitter query: Match if_statement with elif_clause children but no else_clause.\n\n### 2. no-inline-functions\nOriginal: find_inline_functions()\nDescription: \"Functions should not be defined inside other functions in non-test code\"\n\nTree-sitter query: Match function_definition that is a descendant of another function_definition.\nExclude: @python_tests\n\n### 3. no-underscore-imports\nOriginal: find_underscore_imports()\nDescription: \"Do not import underscore-prefixed functions/classes/constants in non-test code\"\n\nTree-sitter query: Match import where the imported name starts with underscore.\nExclude: @python_tests\n\n### 4. no-init-in-non-exception-classes\nOriginal: find_init_methods_in_non_exception_classes()\nDescription: \"Do not define __init__ methods in non-Exception/Error classes. Use Pydantic models instead\"\n\nTree-sitter query: Match class_definition containing __init__ method.\nPost-filter: In Rust, filter out matches where class name ends in \"Exception\" or \"Error\".\nExclude: @python_tests\n\n## Implementation Notes\n- Use tree-sitter-python query syntax\n- Test queries against sample Python code\n- Implement post-filter support in AstRule for rule 4\n\n## Definition of Done\n- All 4 AST ratchets are created as TOML files (3 remaining after no-bare-except moved to regex)\n- Post-filter logic implemented for no-init-in-non-exception-classes\n- All rules load and execute correctly\n- All tests pass\n- cargo clippy passes","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-21T20:26:08.260902967Z","created_by":"Danver Braganza","updated_at":"2026-01-21T22:47:46.116564506Z","labels":["python-ratchets"],"dependencies":[{"issue_id":"code-43","depends_on_id":"code-41","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"code-43","depends_on_id":"code-44","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-44","title":"Add reusable exclusion patterns with @reference syntax","description":"## Goal\nAdd support for defining reusable glob patterns in ratchet.toml that can be referenced in rule files using @name syntax.\n\n## Design\n\n### ratchet.toml addition\n```toml\n[ratchet]\nversion = \"1\"\n\n[patterns]\npython_tests = [\"**/test_*.py\", \"**/*_test.py\", \"**/tests/**\", \"**/conftest.py\"]\nrust_tests = [\"**/tests/**\", \"**/benches/**\"]\ngenerated = [\"**/generated/**\", \"**/vendor/**\"]\n```\n\n### Rule file usage\n```toml\n[rule]\nid = \"no-exec-usage\"\ndescription = \"exec() should not be used\"\nseverity = \"error\"\n\n[match]\npattern = \"\\\\bexec\\\\s*\\\\(\"\nlanguages = [\"python\"]\nexclude = \"@python_tests\"  # @ prefix references pattern from ratchet.toml\n```\n\n## Implementation\n\n### 1. Update Config struct (src/config/ratchet_toml.rs)\nAdd patterns field to Config:\n```rust\npub struct Config {\n    pub version: String,\n    pub languages: Vec\u003cLanguage\u003e,\n    pub include: Vec\u003cGlobPattern\u003e,\n    pub exclude: Vec\u003cGlobPattern\u003e,\n    pub rules: RuleConfig,\n    pub output: OutputConfig,\n    pub patterns: HashMap\u003cString, Vec\u003cGlobPattern\u003e\u003e,  // NEW\n}\n```\n\n### 2. Update rule loading to accept pattern context\nBoth RegexRule::from_toml and AstRule::from_toml need access to the patterns map to resolve @references.\n\nOptions:\na) Add a second parameter: `from_toml(content: \u0026str, patterns: \u0026HashMap\u003cString, Vec\u003cGlobPattern\u003e\u003e)`\nb) Add a resolve step after parsing: `rule.resolve_patterns(patterns)`\nc) Use a context struct: `from_toml(content: \u0026str, ctx: \u0026RuleContext)`\n\nRecommend option (c) for extensibility.\n\n### 3. Pattern resolution logic\nIn the match section parsing:\n- If exclude/include value starts with @, look up in patterns map\n- If not found, return error: \"Unknown pattern reference: @foo\"\n- If found, expand to the glob list\n- If value doesn't start with @, treat as literal glob (existing behavior)\n\n### 4. Support both single reference and mixed lists\n```toml\nexclude = \"@python_tests\"                    # Single reference\nexclude = [\"@python_tests\", \"src/legacy/**\"] # Mixed: reference + literal\n```\n\n### 5. Update documentation\n- DESIGN.md: Document the [patterns] section\n- README.md: Add example in Configuration section\n\n## Files to Modify\n- src/config/ratchet_toml.rs - Add patterns to Config struct\n- src/rules/regex_rule.rs - Accept patterns context, resolve @references\n- src/rules/ast/ast_rule.rs - Accept patterns context, resolve @references  \n- src/rules/registry.rs - Pass patterns context to rule loading\n- src/cli/check.rs - Pass config.patterns to rule loading\n- DESIGN.md - Document feature\n- README.md - Add usage example\n\n## Test Cases\n1. Pattern defined and referenced correctly → resolves to glob list\n2. Pattern referenced but not defined → clear error message\n3. Mixed list with @reference and literal glob → both work\n4. No patterns section in config → empty map, @references error\n5. Backward compatibility: existing configs without [patterns] still work\n\n## Definition of Done\n- [patterns] section parses correctly in ratchet.toml\n- @reference syntax resolves in rule exclude/include fields\n- Clear error messages for undefined pattern references\n- All existing tests pass\n- New tests cover pattern resolution\n- Documentation updated","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-21T21:46:52.158049136Z","created_by":"Danver Braganza","updated_at":"2026-01-21T22:21:47.165606971Z","labels":["feature"],"dependencies":[{"issue_id":"code-44","depends_on_id":"code-41","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-45","title":"Fix @python_tests pattern resolution in load_builtin_ast_rules","description":"The load_builtin_ast_rules method in registry.rs passes None as the RuleContext when loading AST rules from the filesystem (line 283). However, the Python AST rules in builtin-ratchets/python/ast/ use @python_tests pattern reference which requires a RuleContext to resolve.\n\nThe fix should make load_builtin_ast_rules create a default pattern context that includes the python_tests pattern (similar to how load_builtin_ast_rules() in builtin.rs does for embedded rules), or accept a RuleContext parameter.\n\nFiles to modify:\n- src/rules/registry.rs: Update load_builtin_ast_rules to create/use pattern context\n\nError message:\nError: Rule error: Invalid rule definition: Pattern reference '@python_tests' cannot be resolved: no pattern context provided","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-24T07:36:26.982667175Z","created_by":"Danver Braganza","updated_at":"2026-01-24T07:57:08.149108885Z","labels":["bug","fix-ratchet"]}
{"id":"code-46","title":"Silence expected rule override warnings for builtin filesystem rules","description":"When running `cargo run -- check`, warnings appear about rules being overridden:\n```\nWarning: Overriding rule 'no-fixme-comments' with version from builtin-ratchets/common/regex/no-fixme-comments.toml\n```\n\n**Requirements:**\n1. Silence the warnings when filesystem builtin rules override embedded rules (this is expected development behavior)\n2. CRITICAL: Ensure that when a filesystem rule overrides an embedded rule by ID, the embedded rule is REPLACED, not duplicated. After loading, there must be exactly ONE rule per ID.\n3. Only warn when custom rules (from ratchets/) override builtins - this is unexpected and worth warning about.\n\n**Files to investigate:**\n- src/rules/registry.rs: The load methods that handle overrides\n- src/cli/check.rs: build_rule_registry function\n\n**Acceptance criteria:**\n- No warnings when running `cargo run -- check` in the ratchet repo itself\n- Each rule ID appears exactly once in the registry after loading\n- Tests verify no duplicate rule IDs exist","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-24T16:06:53.133921722Z","created_by":"Danver Braganza","updated_at":"2026-01-24T16:21:32.940284004Z","labels":["bug"]}
{"id":"code-47","title":"Consolidate rule loading into single ADT interface - fix bump command","description":"**Problem:**\nThe bump command (src/cli/bump.rs) has its own rule loading logic that differs from check.rs. This leads to inconsistent behavior and bugs. The rule loading should have ONE canonical implementation.\n\n**Requirements:**\n1. First, write a test that demonstrates the current bump command failure (rule not found or similar issue)\n2. Refactor rule loading to use a single ADT (Abstract Data Type) module that is the ONLY way to load rules\n3. All CLI commands (check, bump, tighten, list) must use this single interface\n4. The filtered rules collection must account for:\n   - Embedded builtin rules\n   - Filesystem builtin rules (overriding embedded)\n   - Custom rules\n   - Language filtering based on config\n   - Rule enable/disable from config\n5. Investigate the languages field - ensure it properly filters rules even if commented out in config (should default to all languages or handle gracefully)\n\n**Files to investigate:**\n- src/cli/bump.rs: build_and_filter_rule_registry (has different logic than check.rs)\n- src/cli/check.rs: build_rule_registry \n- src/cli/tighten.rs: likely has similar duplication\n- src/cli/list.rs: likely has similar duplication\n- src/rules/registry.rs: should be the single point of interface\n\n**Acceptance criteria:**\n- Test demonstrating the bug exists and passes after fix\n- Single module/function for loading filtered rules\n- All CLI commands use the same rule loading path\n- cargo fmt, clippy, nextest all pass","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-24T16:14:15.597063135Z","created_by":"Danver Braganza","updated_at":"2026-01-24T16:30:17.116298635Z","labels":["bug","refactor"]}
{"id":"code-48","title":"Ensure language filtering is applied to filtered rules collection","description":"**Problem:**\nThe `languages` config field in ratchet.toml is not used to filter rules. When `languages = [\"rust\"]` is set, Python and TypeScript rules still appear in `ratchet list` output and are loaded into the registry.\n\n**Requirements:**\n1. The filtered rules collection (from bead code-47) must filter rules based on the configured languages\n2. If a rule's language is not in the config's languages list, it should be excluded\n3. Rules with no language restriction (like no-todo-comments) should always be included\n4. This filtering should be part of the single ADT interface from code-47\n\n**Note:** This bead depends on code-47 being completed first, as the language filtering should be part of the consolidated rule loading interface.\n\n**Files to investigate:**\n- src/config/ratchet_toml.rs: languages field parsing\n- src/rules/registry.rs: filter_by_config only handles enable/disable, not languages\n- src/rules/rule.rs: Rule trait has languages() method\n\n**Acceptance criteria:**\n- When languages = [\"rust\"], only Rust rules and language-agnostic rules appear\n- `ratchet list` shows filtered rules matching configured languages\n- Tests verify language filtering works correctly","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-24T16:14:25.509691625Z","created_by":"Danver Braganza","updated_at":"2026-01-24T16:36:50.149478512Z","labels":["bug"]}
{"id":"code-49","title":"Consolidate duplicate CLI helper functions","description":"The CLI modules (check, bump, tighten) have duplicated implementations of load_config, discover_files, and build_rule_registry functions. Each module has its own copy with different error type wrappers.\n\nPROBLEM:\n- load_config() duplicated in check.rs, bump.rs, tighten.rs (lines ~144-163)\n- discover_files() duplicated in all 3 files (lines ~180-200)\n- build_and_filter_rule_registry/build_rule_registry duplicated with inconsistent naming\n\nIMPACT:\n- Changes require updates in 3 places\n- Bug fixes must be replicated\n- Risk of inconsistency across commands\n\nSOLUTION:\nCreate shared helper module (e.g., src/cli/common.rs) with:\n- load_config() -\u003e Result\u003cConfig, ConfigError\u003e\n- discover_files() -\u003e Result\u003cVec\u003cFileEntry\u003e, FileWalkerError\u003e\n- build_registry() -\u003e Result\u003cRuleRegistry, RuleError\u003e\n\nEach CLI command can then convert to their local error types using .map_err() when needed.\n\nFILES TO MODIFY:\n- src/cli/check.rs\n- src/cli/bump.rs  \n- src/cli/tighten.rs\n- src/cli/mod.rs (add new common module)","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-24T16:38:17.01724726Z","created_by":"Danver Braganza","updated_at":"2026-01-24T17:13:07.522661381Z"}
{"id":"code-5","title":"Phase 1: Implement ratchet.toml parsing with serde","description":"Create src/config/ratchet_toml.rs:\n- Config struct matching DESIGN.md schema\n- RuleConfig for rule enable/disable/options\n- OutputConfig for format settings\n- Serde deserialization from TOML\n- Validation: check version field, valid language names, valid glob patterns\n\nUse toml crate for parsing.\n\nDepends on: code-4\n\nDefinition of Done:\n- Config struct can deserialize valid ratchet.toml examples from DESIGN.md\n- Invalid configs produce clear error messages\n- cargo check/fmt/clippy pass","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T03:59:30.305604845Z","created_by":"Danver Braganza","updated_at":"2026-01-12T06:30:55.199859792Z","labels":["phase-1-config"],"dependencies":[{"issue_id":"code-5","depends_on_id":"code-4","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-50","title":"Remove warn_on_override parameter from rule loading","description":"**Task:**\nRemove the `warn_on_override` parameter from rule loading methods in registry.rs. We don't care about warning on overrides - silent replacement is the expected behavior.\n\n**Changes needed:**\n1. Remove `warn_on_override` parameter from:\n   - `load_regex_rules_from_dir()`\n   - `load_ast_rules_from_dir()`\n\n2. Remove the conditional warning logic that uses this parameter\n\n3. Update all call sites:\n   - `load_builtin_regex_rules()`\n   - `load_custom_regex_rules()`\n   - `load_builtin_ast_rules()`\n   - `load_custom_ast_rules()`\n\n4. Update documentation and comments to be consistent - no mention of warning behavior\n\n5. Update or remove tests that specifically test the warning behavior (`test_override_warnings_controlled_by_parameter`)\n\n**Files to modify:**\n- src/rules/registry.rs\n\n**Definition of Done:**\n- No `warn_on_override` parameter exists\n- Documentation is consistent (no mention of warning on override)\n- `cargo fmt --check` passes\n- `cargo clippy --all-targets --all-features` passes\n- `cargo nextest run` passes","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-24T16:48:49.103157303Z","created_by":"Danver Braganza","updated_at":"2026-01-24T16:55:36.081213672Z","labels":["cleanup"]}
{"id":"code-51","title":"Add Registry section to DESIGN.md documenting rule loading","description":"**Task:**\nAdd a section to DESIGN.md documenting the Rule Registry as the single point of interface for rule loading.\n\n**Requirements:**\n1. Read the existing DESIGN.md to understand its voice and style\n2. Add a section (in appropriate location) describing:\n   - The RuleRegistry as the canonical way to load rules\n   - The `build_from_config()` method as the ONLY function for normal operation\n   - The loading order: embedded → filesystem builtins → custom → config filter → language filter\n   - Why this single point of interface matters (consistency, no duplicates, proper filtering)\n\n3. Verify that ALL rule loading in the codebase goes through RuleRegistry:\n   - Check src/cli/check.rs\n   - Check src/cli/bump.rs\n   - Check src/cli/tighten.rs\n   - Check src/cli/list.rs\n   - Check any other files that might load rules\n\n4. If any code loads rules outside RuleRegistry, fix it or report it\n\n**Files to modify:**\n- DESIGN.md\n\n**Files to verify:**\n- src/cli/*.rs\n- src/rules/registry.rs\n\n**Definition of Done:**\n- DESIGN.md has new Registry section matching existing voice/style\n- All rule loading verified to go through RuleRegistry\n- `cargo fmt --check` passes\n- `cargo clippy --all-targets --all-features` passes\n- `cargo nextest run` passes","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-24T16:48:59.105738502Z","created_by":"Danver Braganza","updated_at":"2026-01-24T16:58:42.783699591Z","labels":["docs"]}
{"id":"code-52","title":"Bump ratchet version to 0.2.0","description":"Bump the ratchet version in Cargo.toml from 0.1.0 to 0.2.0 to reflect the significant improvements made:\n\n- Consolidated rule loading into single RuleRegistry::build_from_config()\n- Added language filtering\n- Silenced override warnings\n- Added Registry documentation to DESIGN.md\n- Consolidated CLI helper functions\n\nFiles to modify:\n- Cargo.toml: Change version from \"0.1.0\" to \"0.2.0\"\n\nDefinition of Done:\n- Version bumped to 0.2.0\n- cargo fmt --check passes\n- cargo clippy passes\n- cargo nextest run passes","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-24T17:25:50.365011178Z","created_by":"Danver Braganza","updated_at":"2026-01-24T17:28:04.563622046Z","labels":["release"]}
{"id":"code-53","title":"Move load_counts to common.rs and consolidate duplicates","description":"Move load_counts() and EXIT_* constants from check.rs to common.rs. Consolidate duplicate counts loading logic in bump.rs and tighten.rs to use the shared function. This eliminates cross-module coupling where list.rs, bump.rs, and tighten.rs import from check.rs, and reduces code duplication across multiple files.\n\nDetails:\n- Move EXIT_SUCCESS, EXIT_ERROR, EXIT_EXCEEDED, EXIT_PARSE_ERROR to common.rs\n- Move load_counts() function to common.rs\n- Update bump.rs to use common::load_counts() instead of duplicated logic\n- Update tighten.rs to use common::load_counts() instead of duplicated logic\n- Update all imports to reference common module instead of check module","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-24T17:51:43.618794925Z","created_by":"Danver Braganza","updated_at":"2026-01-24T17:58:53.75051818Z","labels":["code","refactor"]}
{"id":"code-54","title":"Design: Exclude non-program files from ratchet violation checking","description":"## Problem\n\nRatchet currently checks all files matching include patterns, including non-program files like:\n- .beads/issues.jsonl (task metadata)\n- ratchet-counts.toml (configuration)\n- DESIGN.md, ARCHITECTURE.md (documentation)\n- builtin-ratchets/*.toml (rule definitions that mention patterns like FIXME)\n\nRules like no-todo-comments and no-fixme-comments are designed for program source code, not metadata or documentation.\n\n## Requirements\n\n1. Define what constitutes a program file vs non-program file\n2. Design a mechanism to automatically exclude non-program files from comment-based rules\n3. Consider whether this should be:\n   - Rule-level configuration (rules declare what file types they apply to)\n   - Global configuration (ratchet.toml specifies program file patterns)\n   - Language-based (only check files with recognized language extensions)\n4. Ensure backward compatibility with existing configurations\n5. Document the design decision\n\n## Success Criteria\n\n- Running cargo run -- check should not report violations in .beads/, *.md, or *.toml files for comment-based rules\n- The solution should be generalizable to other non-code-quality rules","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-25T21:59:49.985488799Z","created_by":"Danver Braganza","updated_at":"2026-01-25T22:09:35.522390755Z","labels":["design","architecture"]}
{"id":"code-55","title":"Remove unwrap() from ast_rule.rs production code","description":"## Problem\n\nTwo unwrap() calls exist in production code in src/rules/ast/ast_rule.rs, violating STYLE_GUIDE.md.\n\n## Locations\n\n1. Line 234: `parser.language().unwrap()` in `execute_with_tree()`\n2. Line 318: `parser.language().unwrap()` in `validate_query()`\n\n## Proposed Solutions\n\n**Line 234 - Use early return pattern:**\n```rust\nlet tree_sitter_lang = match parser.language() {\n    Some(lang) =\u003e lang,\n    None =\u003e return vec![], // Parser not properly configured\n};\n```\n\n**Line 318 - Use ok_or_else (function already returns Result):**\n```rust\nlet tree_sitter_lang = parser.language().ok_or_else(|| {\n    RuleError::InvalidQuery(\"Parser language not configured\".to_string())\n})?;\n```\n\n## Success Criteria\n- No unwrap() in production code paths\n- All tests pass\n- cargo clippy passes","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-25T22:02:53.372883092Z","created_by":"Danver Braganza","updated_at":"2026-01-25T22:02:53.372883092Z","labels":["bug","style"]}
{"id":"code-56","title":"Remove unwrap() from executor.rs production code","description":"## Problem\n\nOne unwrap() call exists in production code in src/engine/executor.rs at line 122, violating STYLE_GUIDE.md.\n\n## Location\n\nLine 122: `file.language.unwrap()` in execute() method\n\nCurrent code:\n```rust\nlet tree = if !ast_rules.is_empty() \u0026\u0026 file.language.is_some() {\n    self.parse_ast(\u0026content, file.language.unwrap())\n} else {\n    None\n};\n```\n\nThe unwrap is guarded by is_some() check, so it cannot panic, but it still violates the style guide.\n\n## Proposed Solution\n\nUse and_then combinator:\n```rust\nlet tree = if !ast_rules.is_empty() {\n    file.language.and_then(|lang| self.parse_ast(\u0026content, lang))\n} else {\n    None\n};\n```\n\n## Success Criteria\n- No unwrap() in production code paths\n- All tests pass\n- cargo clippy passes","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-25T22:02:59.82351597Z","created_by":"Danver Braganza","updated_at":"2026-01-25T22:02:59.82351597Z","labels":["bug","style"]}
{"id":"code-57","title":"Design: Idiomatic test patterns to eliminate unwrap/expect","description":"## Problem\n\nThe test suite contains ~500+ unwrap/expect calls across 12 test files. While STYLE_GUIDE.md allows these in tests, there are more idiomatic patterns that provide:\n- Better failure messages\n- Cleaner code\n- Consistent patterns across the codebase\n\n## Analysis Summary\n\n| File | unwrap/expect count |\n|------|---------------------|\n| e2e_integration_tests.rs | 120 |\n| engine_integration_tests.rs | 94 |\n| cli_integration_tests.rs | 73 |\n| ast_integration_tests.rs | 55 |\n| scalability_tests.rs | 38 |\n| check_command_tests.rs | 34 |\n| file_walker_tests.rs | 29 |\n| foundation_tests.rs | 24 |\n| config_tests.rs | 23 |\n| regex_rules_tests.rs | 4 |\n\n## Recommended Patterns\n\n1. **Tests returning Result\u003c(), E\u003e** - Use ? operator instead of unwrap\n2. **let-else pattern** - `let Some(x) = opt else { panic!(\"message\"); };`\n3. **Helper macros** - Create assert_ok!, assert_some! macros\n4. **Result-returning helpers** - Refactor setup_* functions to return Result\n\n## Implementation Plan\n\n1. Create tests/common/mod.rs with TestResult type and helper macros\n2. Convert helper functions to return Result\n3. Migrate test files incrementally (smallest first)\n4. Consider adding anyhow to dev-dependencies\n\n## Success Criteria\n- Establish consistent test patterns\n- Improve test failure messages\n- Maintain test coverage","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-25T22:03:17.581890256Z","created_by":"Danver Braganza","updated_at":"2026-01-25T22:03:17.581890256Z","labels":["refactor","testing"]}
{"id":"code-6","title":"Phase 1: Implement ratchet-counts.toml parsing","description":"Create src/config/counts.rs:\n- CountsManager struct\n- RegionTree for hierarchical count storage  \n- Parse [rule-id] sections with region path keys\n- get_budget(rule_id, file_path) -\u003e u64 with inheritance logic\n- Mutation methods for bump/tighten: set_count, reduce_to_current\n- Serialize back to TOML preserving formatting where possible\n\nFollow the inheritance semantics from DESIGN.md:\n- Root '.' defaults to 0\n- Child regions inherit from nearest parent override\n\nDepends on: code-5\n\nDefinition of Done:\n- Can parse example ratchet-counts.toml from DESIGN.md\n- Inheritance resolution works correctly\n- Can serialize modified counts back\n- cargo check/fmt/clippy pass","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T03:59:38.257198209Z","created_by":"Danver Braganza","updated_at":"2026-01-12T08:05:45.703008802Z","labels":["phase-1-config"],"dependencies":[{"issue_id":"code-6","depends_on_id":"code-5","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-7","title":"Phase 1: Test configuration parsing","description":"Create comprehensive tests for config module:\n- Unit tests for ratchet.toml parsing (valid cases)\n- Unit tests for ratchet.toml validation errors\n- Unit tests for counts.toml parsing\n- Unit tests for region inheritance resolution\n- Integration tests with fixture files in tests/fixtures/config/\n\nDepends on: code-6\n\nDefinition of Done:\n- All config parsing edge cases covered\n- Inheritance tests verify parent-\u003echild budget resolution\n- cargo nextest run passes\n- cargo fmt/clippy pass","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T03:59:44.138808712Z","created_by":"Danver Braganza","updated_at":"2026-01-12T08:13:18.440904178Z","labels":["phase-1-config","testing"],"dependencies":[{"issue_id":"code-7","depends_on_id":"code-6","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-8","title":"Phase 2: Implement file walker with ignore crate","description":"Create src/engine/file_walker.rs:\n- FileWalker struct using ignore crate for gitignore-aware traversal\n- Filter by include/exclude glob patterns from config\n- Determine Language from file extension\n- Return Iterator\u003cItem = FileEntry\u003e with path and detected language\n- Parallel file discovery using ignore's parallel walker\n\nKey requirements:\n- Respect .gitignore automatically\n- Apply config include/exclude patterns on top\n- Map extensions to Language enum\n\nDepends on: code-7\n\nDefinition of Done:\n- Can walk a directory respecting gitignore\n- Include/exclude patterns filter correctly\n- Language detection works for supported extensions\n- cargo check/fmt/clippy pass","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T03:59:56.329421801Z","created_by":"Danver Braganza","updated_at":"2026-01-12T08:35:47.058015588Z","labels":["phase-2-filesystem"],"dependencies":[{"issue_id":"code-8","depends_on_id":"code-7","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-9","title":"Phase 2: Test file walker","description":"Create tests for file walking:\n- Unit tests for language detection from extensions\n- Integration tests with test directory structures\n- Tests verifying gitignore is respected\n- Tests for include/exclude pattern filtering\n- Tests for symlink handling\n\nCreate test fixtures in tests/fixtures/file_walker/\n\nDepends on: code-8\n\nDefinition of Done:\n- File walker correctly handles nested directories\n- Gitignore patterns are respected\n- Include/exclude patterns work as expected\n- cargo nextest run passes","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-12T04:00:01.349847554Z","created_by":"Danver Braganza","updated_at":"2026-01-12T08:43:56.792556051Z","labels":["phase-2-filesystem","testing"],"dependencies":[{"issue_id":"code-9","depends_on_id":"code-8","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
